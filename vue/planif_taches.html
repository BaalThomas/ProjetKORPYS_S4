<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Tâches - Calendrier</title>
    <link rel="stylesheet" href="css/planif_taches.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Gestion de Tâches</h1>
            <nav>
                <ul class="navbar">
                    <li><a href="accueil.html">Accueil</a></li>
                    <li><a href="creation_projet.html">Créer un Projet</a></li>
                    <li><a href="liste_des_projets.html">Liste des Projets</a></li>
                    <li><a href="connexion.html">Se connecter</a></li>
                </ul>
            </nav>
        </div>
    </header>
    

    <main>
        <section class="calendar">
            <h2>Planification des Tâches</h2>

            <!-- Affichage du nom du projet -->
            <div class="project-info">
                <h3>Projet : <span id="project-name">Mon projet</span></h3>
            </div>

            <!-- Conteneur des boutons de navigation de la semaine -->
            <div class="week-navigation">
                <button onclick="changeWeek(-1)">Semaine Précédente</button>
                <button onclick="changeWeek(1)">Semaine Suivante</button>
            </div>

    
            <!-- Boutons pour modifier ou supprimer la tâche sélectionnée -->
            <div class="edit-task">
                <button onclick="toggleTaskForm()" class="css_ajoutClass">Ajouter une Nouvelle Tâche</button>
                <button onclick="editSelectedTask()" class= "css_modifClass">Modifier la Tâche</button>
                <button onclick="deleteSelectedTask()" class = "css_supprClass">Supprimer la Tâche</button>
            </div>

            <!-- Formulaire pour ajouter une tâche (caché par défaut) -->
            <div id="task-form" class="task-form" style="display: none;">
                <h3>Ajouter une nouvelle tâche</h3>
                <label for="task-day">Jour:</label>
                <select id="task-day">
                    <option value="Lundi">Lundi</option>
                    <option value="Mardi">Mardi</option>
                    <option value="Mercredi">Mercredi</option>
                    <option value="Jeudi">Jeudi</option>
                    <option value="Vendredi">Vendredi</option>
                    <option value="Samedi">Samedi</option>
                    <option value="Dimanche">Dimanche</option>
                </select>

                <label for="task-description">Description:</label>
                <input type="text" id="task-description" placeholder="Description de la tâche" />

                <label for="task-duration">Durée (en heures):</label>
                <input type="number" id="task-duration" placeholder="Durée estimée" min="1" />

                <button onclick="addTask()">Ajouter</button>
                <button onclick="toggleTaskForm()">Annuler</button>
            </div>

            <!-- Grille de calendrier -->
            <div class="calendar-grid" id="calendar-grid">
                <!-- Les jours de la semaine seront mis à jour dynamiquement -->
            </div>
        </section>
    </main>

    <footer>
        <p>© 2025 Gestion de Tâches - Tous droits réservés.</p>
    </footer>

    <script>
        let currentWeek = 0; // Semaine actuelle (0 = Semaine courante)
        let selectedTask = null; // Variable pour la tâche sélectionnée
        const projectName = "Projet Test Généré"; // Nom du projet

        // Les tâches des semaines (exemple simplifié)
        const tasksForWeeks = [
            [
                { day: "Lundi", tasks: ["Tâche 1: Description, 3h", "Tâche 2: Description, 2h"] },
                { day: "Mardi", tasks: ["Tâche 3: Description, 1h"] },
                { day: "Mercredi", tasks: ["Tâche 4: Description, 4h"] },
                { day: "Jeudi", tasks: ["Tâche 5: Description, 2h"] },
                { day: "Vendredi", tasks: ["Tâche 6: Description, 3h"] },
                { day: "Samedi", tasks: ["Tâche 7: Description, 1h"] },
                { day: "Dimanche", tasks: ["Tâche 8: Description, 2h"] }
            ],
            // Semaine suivante (exemple modifié)
            [
                { day: "Lundi", tasks: ["Tâche 9: Description, 2h"] },
                { day: "Mardi", tasks: ["Tâche 10: Description, 1h"] },
                { day: "Mercredi", tasks: ["Tâche 11: Description, 3h"] },
                { day: "Jeudi", tasks: ["Tâche 12: Description, 1h"] },
                { day: "Vendredi", tasks: ["Tâche 13: Description, 4h"] },
                { day: "Samedi", tasks: ["Tâche 14: Description, 2h"] },
                { day: "Dimanche", tasks: ["Tâche 15: Description, 3h"] }
            ]
        ];

        // Fonction pour changer de semaine
        function changeWeek(direction) {
            currentWeek += direction;
            renderWeek(currentWeek);
        }

        // Fonction pour afficher les tâches de la semaine
        function renderWeek(weekIndex) {
            const calendarGrid = document.getElementById("calendar-grid");
            calendarGrid.innerHTML = ""; // Efface la grille actuelle

            // Assurer que la semaine ne dépasse pas les limites
            if (weekIndex < 0) {
                currentWeek = 0;
                return;
            }
            if (weekIndex >= tasksForWeeks.length) {
                currentWeek = tasksForWeeks.length - 1;
                return;
            }

            const weekTasks = tasksForWeeks[weekIndex];

            // Crée la grille pour la semaine
            weekTasks.forEach((day, dayIndex) => {
                const dayElement = document.createElement("div");
                dayElement.classList.add("calendar-day");
                dayElement.innerHTML = `
                    <h3>${day.day}</h3>
                    <ul>
                        ${day.tasks.map((task, taskIndex) => `
                            <li id="task-${weekIndex}-${dayIndex}-${taskIndex}" 
                                class="task-item" 
                                onclick="selectTask(${weekIndex}, ${dayIndex}, ${taskIndex})">
                                ${task}
                            </li>
                        `).join('')}
                    </ul>
                `;
                calendarGrid.appendChild(dayElement);
            });
        }

        // Fonction pour sélectionner une tâche
        function selectTask(weekIndex, dayIndex, taskIndex) {
            // Désélectionner la tâche précédente
            if (selectedTask !== null) {
                const previousTaskElement = document.getElementById(selectedTask);
                previousTaskElement.classList.remove("selected");
            }

            // Sélectionner la nouvelle tâche
            selectedTask = `task-${weekIndex}-${dayIndex}-${taskIndex}`;
            const taskElement = document.getElementById(selectedTask);
            taskElement.classList.add("selected");
        }

        // Fonction pour modifier la tâche sélectionnée
        function editSelectedTask() {
            if (selectedTask === null) {
                alert("Veuillez sélectionner une tâche à modifier.");
                return;
            }

            const [weekIndex, dayIndex, taskIndex] = selectedTask.split('-').slice(1).map(Number);
            const task = tasksForWeeks[weekIndex][dayIndex].tasks[taskIndex];
            const newTaskDescription = prompt("Modifier la tâche:", task);

            if (newTaskDescription) {
                tasksForWeeks[weekIndex][dayIndex].tasks[taskIndex] = newTaskDescription;
                renderWeek(currentWeek);
            }
        }

        // Fonction pour supprimer la tâche sélectionnée
        function deleteSelectedTask() {
            if (selectedTask === null) {
                alert("Veuillez sélectionner une tâche à supprimer.");
                return;
            }

            const [weekIndex, dayIndex, taskIndex] = selectedTask.split('-').slice(1).map(Number);

            // Supprimer la tâche de la liste
            tasksForWeeks[weekIndex][dayIndex].tasks.splice(taskIndex, 1);

            // Réinitialiser la tâche sélectionnée
            selectedTask = null;

            // Réafficher la semaine après suppression
            renderWeek(currentWeek);
        }

        // Fonction pour afficher/masquer le formulaire de création de tâche
        function toggleTaskForm() {
            const taskForm = document.getElementById("task-form");
            taskForm.style.display = taskForm.style.display === "none" ? "block" : "none";
        }

        // Fonction pour ajouter une nouvelle tâche
        function addTask() {
            const day = document.getElementById("task-day").value;
            const description = document.getElementById("task-description").value;
            const duration = document.getElementById("task-duration").value;

            if (!description || !duration) {
                alert("Veuillez remplir tous les champs.");
                return;
            }

            // Ajouter la tâche à la semaine actuelle
            const task = `${description}, ${duration}h`;

            const dayIndex = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"].indexOf(day);
            tasksForWeeks[currentWeek][dayIndex].tasks.push(task);

            // Réafficher la semaine avec la nouvelle tâche
            renderWeek(currentWeek);

            // Fermer le formulaire après ajout
            toggleTaskForm();
        }

        // Initialiser la première semaine
        renderWeek(currentWeek);
        
        // Mettre à jour le nom du projet
        document.getElementById('project-name').innerText = projectName;
    </script>
</body>
</html>
